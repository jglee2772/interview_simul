"""
ì•±: resume (ì´ë ¥ì„œ)
íŒŒì¼: views.py
ì—­í• : API ë·°(ì»¨íŠ¸ë¡¤ëŸ¬) ì‘ì„±
"""

import json
import logging
from django.conf import settings
from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response
from rest_framework.permissions import AllowAny
from openai import OpenAI

logger = logging.getLogger(__name__)

SECTION_LABELS = {
    'growthProcess': 'ì„±ì¥ê³¼ì •',
    'strengthsWeaknesses': 'ì„±ê²©ì˜ ì¥ë‹¨ì ',
    'academicLife': 'í•™ì—…ìƒí™œ',
    'motivation': 'ì§€ì›ë™ê¸°ì™€ ì…ì‚¬ í›„ í¬ë¶€'
}

ANALYZE_SECTION_PROMPT_TEMPLATE = """ë‹¹ì‹ ì€ 15ë…„ ê²½ë ¥ì˜ ëŒ€ê¸°ì—… HR ë‹´ë‹¹ìì´ì ì·¨ì—… ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤. ì‹¤ì œ ì±„ìš© í˜„ì¥ì—ì„œ ìˆ˜ì²œ ëª…ì˜ ì´ë ¥ì„œë¥¼ ê²€í† í•˜ê³  ë©´ì ‘ì„ ì§„í–‰í•œ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ë‚´ìš©ì„ ì‹¤ì œ ì±„ìš© ë‹´ë‹¹ìì˜ ì‹œì„ ìœ¼ë¡œ ë¶„ì„í•˜ì—¬, êµ¬ì²´ì ì´ê³  ì‹¤ì „ì ì¸ ê°œì„ ì•ˆì„ ì œì‹œí•˜ì„¸ìš”.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ë¶„ì„ ëŒ€ìƒ ì„¹ì…˜: {section_label}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{content}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì¤‘ìš” ì§€ì¹¨:
- ìœ„ ë‚´ìš©ë§Œ ë¶„ì„í•˜ì„¸ìš”. ì¼ë°˜ì ì¸ ì˜ˆì‹œë‚˜ í…œí”Œë¦¿ì€ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
- ì±„ìš© ë‹´ë‹¹ìê°€ ì‹¤ì œë¡œ ë¬¸ì œë¼ê³  ìƒê°í•  ë§Œí•œ êµ¬ì²´ì  ì§€ì ì„ ì°¾ìœ¼ì„¸ìš”.
- ëª¨ë“  ê°œì„ ì•ˆì€ ì´ë ¥ì„œì— ë°”ë¡œ ì ìš© ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.
- ìˆ˜ì¹˜, ê¸°ê°„, ì„±ê³¼ëŠ” ë°˜ë“œì‹œ êµ¬ì²´ì ìœ¼ë¡œ ëª…ì‹œí•˜ì„¸ìš”.
- ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì„ ì ê·¹ í™œìš©í•˜ì—¬ ê°€ì‹œì„±ì„ ë†’ì´ì„¸ìš”. **ë³¼ë“œ**, ## í—¤ë”©, (ê´„í˜¸), â€¢ ë¶ˆë¦¿ ë“±ì„ ì‚¬ìš©í•˜ì„¸ìš”.
- ê° ì„¹ì…˜ ì‚¬ì´ì—ëŠ” ë¹ˆ ì¤„ì„ ë‘ì–´ ê°€ë…ì„±ì„ ë†’ì´ì„¸ìš”.
- ì‹¤ìš©ì ì´ê³  ì¦‰ì‹œ í™œìš© ê°€ëŠ¥í•œ ì¡°ì–¸ì„ ì œê³µí•˜ì„¸ìš”.

ì¶œë ¥ í˜•ì‹ - ì•„ë˜ êµ¬ì¡°ë¥¼ ì •í™•íˆ ë”°ë¥´ì„¸ìš” (ë§ˆí¬ë‹¤ìš´ í˜•ì‹ ì‚¬ìš©):

## ğŸ” [ë¬¸ì œì  ìš”ì•½]

**í•µì‹¬ ë¬¸ì œ:**
ë¬¸ì œì ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ëª…í™•íˆ ì œì‹œí•˜ì„¸ìš”.

**ì™œ ë¬¸ì œì¸ê°€?**
ì±„ìš© ë‹´ë‹¹ìê°€ ì´ ë¶€ë¶„ì„ ë³´ê³  ë– ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ì˜ë¬¸ì ì´ë‚˜ ìš°ë ¤ì‚¬í•­ì„ ì„¤ëª…í•˜ì„¸ìš”. ë©´ì ‘ê´€ì´ ì–´ë–¤ ì§ˆë¬¸ì„ í•  ê°€ëŠ¥ì„±ì´ ë†’ì€ì§€ë„ í•¨ê»˜ ì œì‹œí•˜ì„¸ìš”. (ì˜ˆ: "ì´ ë¶€ë¶„ì€ ë©´ì ‘ì—ì„œ ë°˜ë“œì‹œ ë¬¼ì–´ë³¼ ê°€ëŠ¥ì„±ì´ 90% ì´ìƒì…ë‹ˆë‹¤")


## âœï¸ [í”¼ë“œë°± ë° ê°œì„ ì‚¬í•­]

### Before (í˜„ì¬ ë‚´ìš©)
> ë¬¸ì œê°€ ìˆëŠ” ì‹¤ì œ ë¬¸ì¥ì„ ê·¸ëŒ€ë¡œ ì¸ìš©í•˜ì„¸ìš”.

### After (ê°œì„ ëœ ë‚´ìš©)
STAR ê¸°ë²•ì„ ì ìš©í•œ êµ¬ì²´ì  ê°œì„ ì•ˆì„ ì‘ì„±í•˜ì„¸ìš”. ë°˜ë“œì‹œ ìˆ˜ì¹˜ì™€ ì„±ê³¼ë¥¼ í¬í•¨í•˜ì„¸ìš”.

**Situation (ìƒí™©):** ìƒí™©ì„ 1ì¤„ë¡œ ì„¤ëª…

**Task (ê³¼ì œ):** ê³¼ì œë‚˜ ëª©í‘œë¥¼ 1ì¤„ë¡œ ì„¤ëª… (ìˆ˜ì¹˜ í¬í•¨)

**Action (í–‰ë™):** êµ¬ì²´ì  í–‰ë™ì„ 2-3ì¤„ë¡œ ì„¤ëª… (ìˆ˜ì¹˜, ê¸°ê°„, ë°©ë²• ëª…ì‹œ)

**Result (ê²°ê³¼):** ì¸¡ì • ê°€ëŠ¥í•œ ì„±ê³¼ë¥¼ 1-2ì¤„ë¡œ ì„¤ëª… (ìˆ˜ì¹˜ í•„ìˆ˜)

**ğŸ’¡ ê°œì„  í¬ì¸íŠ¸:**
Beforeì™€ Afterì˜ ê°€ì¥ ì¤‘ìš”í•œ ì°¨ì´ì ê³¼, ì´ ê°œì„ ì•ˆì´ ì±„ìš© ë‹´ë‹¹ìì—ê²Œ ì–´ë–»ê²Œ ì–´í•„ë˜ëŠ”ì§€ ì„¤ëª…í•˜ì„¸ìš”. (ì˜ˆ: "ìˆ˜ì¹˜ê°€ ëª…í™•í•´ì ¸ì„œ ì‹ ë¢°ë„ê°€ 80% í–¥ìƒë©ë‹ˆë‹¤")


## ğŸ“‹ [ê°œì„ ëœ ë‚´ìš© ì˜ˆì‹œ - ë°”ë¡œ ë³µì‚¬í•´ì„œ ì‚¬ìš©]

ìœ„ì—ì„œ ì œì‹œí•œ After ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë‹¤ì‹œ í•œ ë²ˆ ì œì‹œí•˜ì—¬, ì‚¬ìš©ìê°€ ë°”ë¡œ ë³µì‚¬í•´ì„œ ì´ë ¥ì„œì— ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆë„ë¡ í•˜ì„¸ìš”.

**ğŸ’¬ ì‚¬ìš© íŒ:**
ì´ ì˜ˆì‹œë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜, ë³¸ì¸ì˜ ì‹¤ì œ ê²½í—˜ì— ë§ê²Œ ìˆ˜ì¹˜ì™€ ì„±ê³¼ë§Œ ìˆ˜ì •í•˜ì—¬ í™œìš©í•˜ì„¸ìš”.


## ğŸ¯ [ì˜ˆìƒ ì§ˆë¬¸ ë° ëŒ€ì‘]

### Q1: ì´ ì„¹ì…˜ì—ì„œ ë‚˜ì˜¬ ê°€ëŠ¥ì„±ì´ ê°€ì¥ ë†’ì€ ì§ˆë¬¸

**ë©´ì ‘ê´€ì´ ì´ ì§ˆë¬¸ì„ í•˜ëŠ” ì´ìœ :**
ì´ ì§ˆë¬¸ì´ ì™œ ë‚˜ì˜¬ ìˆ˜ë°–ì— ì—†ëŠ”ì§€ ì„¤ëª…í•˜ì„¸ìš”. (ì˜ˆ: "ì´ë ¥ì„œì˜ ëª¨í˜¸í•œ í‘œí˜„ ë•Œë¬¸ì— ë°˜ë“œì‹œ í™•ì¸í•˜ê³  ì‹¶ì–´í•©ë‹ˆë‹¤")

**ì™„ë²½í•œ ë‹µë³€ (STAR ê¸°ë²•):**

**S (Situation):** ìƒí™© ì„¤ëª… 1ì¤„

**T (Task):** ê³¼ì œë‚˜ ëª©í‘œ 1ì¤„ (ìˆ˜ì¹˜ í¬í•¨)

**A (Action):** êµ¬ì²´ì  í–‰ë™ 2ì¤„ (ìˆ˜ì¹˜, ê¸°ê°„, ë°©ë²• ëª…ì‹œ)

**R (Result):** ì¸¡ì • ê°€ëŠ¥í•œ ì„±ê³¼ 1ì¤„ (ìˆ˜ì¹˜ í•„ìˆ˜)

**âœ… ë©´ì ‘ê´€ì´ ì¢‹ì•„í•˜ëŠ” í‘œí˜„:**
ì‹¤ì œë¡œ ë©´ì ‘ì¥ì—ì„œ ë§í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë¬¸ì¥ì„ ì œì‹œí•˜ì„¸ìš”. (ì˜ˆ: "ì €ëŠ” 3ê°œì›”ê°„ ë§¤ì¼ ê³ ê° 20ëª…ì—ê²Œ ì§ì ‘ ë°©ë¬¸í•˜ì—¬ ë§¤ì¶œì„ 30% ì¦ê°€ì‹œì¼°ìŠµë‹ˆë‹¤")

**âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  í‘œí˜„:**
í”¼í•´ì•¼ í•  í‘œí˜„ì„ ì œì‹œí•˜ì„¸ìš”. (ì˜ˆ: "ì—´ì‹¬íˆ í–ˆìŠµë‹ˆë‹¤", "ë§ì´ ë°°ì› ìŠµë‹ˆë‹¤" ë“± ëª¨í˜¸í•œ í‘œí˜„)

---

### Q2: ì¶”ê°€ë¡œ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” ì§ˆë¬¸ (í•„ìš”í•œ ê²½ìš°ë§Œ)

**ë©´ì ‘ê´€ì´ ì´ ì§ˆë¬¸ì„ í•˜ëŠ” ì´ìœ :**
ì´ ì§ˆë¬¸ì´ ì™œ ë‚˜ì˜¬ ìˆ˜ë°–ì— ì—†ëŠ”ì§€ ì„¤ëª…í•˜ì„¸ìš”.

**ì™„ë²½í•œ ë‹µë³€ (STAR ê¸°ë²•):**

**S (Situation):** ìƒí™© ì„¤ëª… 1ì¤„

**T (Task):** ê³¼ì œë‚˜ ëª©í‘œ 1ì¤„ (ìˆ˜ì¹˜ í¬í•¨)

**A (Action):** êµ¬ì²´ì  í–‰ë™ 2ì¤„ (ìˆ˜ì¹˜, ê¸°ê°„, ë°©ë²• ëª…ì‹œ)

**R (Result):** ì¸¡ì • ê°€ëŠ¥í•œ ì„±ê³¼ 1ì¤„ (ìˆ˜ì¹˜ í•„ìˆ˜)

**âœ… ë©´ì ‘ê´€ì´ ì¢‹ì•„í•˜ëŠ” í‘œí˜„:**
ì‹¤ì œë¡œ ë©´ì ‘ì¥ì—ì„œ ë§í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë¬¸ì¥ì„ ì œì‹œí•˜ì„¸ìš”.

**âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  í‘œí˜„:**
í”¼í•´ì•¼ í•  í‘œí˜„ì„ ì œì‹œí•˜ì„¸ìš”.
"""

ANALYZE_FULL_PROMPT_TEMPLATE = """ë‹¹ì‹ ì€ 15ë…„ ê²½ë ¥ì˜ ëŒ€ê¸°ì—… HR ë‹´ë‹¹ìì´ì ë©´ì ‘ê´€ì…ë‹ˆë‹¤. ì‹¤ì œ ì±„ìš© í˜„ì¥ì—ì„œ ìˆ˜ì²œ ëª…ì˜ ì´ë ¥ì„œë¥¼ ê²€í† í•˜ê³  ìˆ˜ë°± ëª…ì˜ ë©´ì ‘ì„ ì§„í–‰í•œ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì´ë ¥ì„œë¥¼ ì‹¤ì œ ì±„ìš© ë‹´ë‹¹ìì˜ ì‹œì„ ìœ¼ë¡œ ë¶„ì„í•˜ì—¬, êµ¬ì²´ì ì´ê³  ì‹¤ì „ì ì¸ ë©´ì ‘ ëŒ€ì‘ ì „ëµì„ ì œì‹œí•˜ì„¸ìš”.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì´ë ¥ì„œ ì „ì²´ ë°ì´í„°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{resume_json}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì¤‘ìš” ì§€ì¹¨:
- ìœ„ ë°ì´í„°ë§Œ ë¶„ì„í•˜ì„¸ìš”. ì¼ë°˜ì ì¸ ì˜ˆì‹œë‚˜ í…œí”Œë¦¿ì€ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
- ì‹¤ì œ ë©´ì ‘ê´€ì´ ë°˜ë“œì‹œ ë¬¼ì–´ë´ì•¼ í•  ì§ˆë¬¸ì„ ì°¾ìœ¼ì„¸ìš”.
- ëª¨ë“  ëŒ€ì‘ ì „ëµì€ ë©´ì ‘ì¥ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
- ìˆ˜ì¹˜, ê¸°ê°„, ì„±ê³¼ëŠ” ë°˜ë“œì‹œ êµ¬ì²´ì ìœ¼ë¡œ ëª…ì‹œí•˜ì„¸ìš”.
- ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì„ ì ê·¹ í™œìš©í•˜ì—¬ ê°€ì‹œì„±ì„ ë†’ì´ì„¸ìš”. **ë³¼ë“œ**, ## í—¤ë”©, (ê´„í˜¸), â€¢ ë¶ˆë¦¿ ë“±ì„ ì‚¬ìš©í•˜ì„¸ìš”.
- ê° ì„¹ì…˜ ì‚¬ì´ì—ëŠ” ë¹ˆ ì¤„ì„ ë‘ì–´ ê°€ë…ì„±ì„ ë†’ì´ì„¸ìš”.
- ì‹¤ìš©ì ì´ê³  ì¦‰ì‹œ í™œìš© ê°€ëŠ¥í•œ ì¡°ì–¸ì„ ì œê³µí•˜ì„¸ìš”.

ì¶œë ¥ í˜•ì‹ - ì•„ë˜ êµ¬ì¡°ë¥¼ ì •í™•íˆ ë”°ë¥´ì„¸ìš” (ë§ˆí¬ë‹¤ìš´ í˜•ì‹ ì‚¬ìš©):

## ğŸ” [ë¬¸ì œì  ìš”ì•½]

**í•µì‹¬ ë¬¸ì œ:**
ì´ë ¥ì„œì—ì„œ ê°€ì¥ ëˆˆì— ë„ëŠ” ë¬¸ì œì ì´ë‚˜ ì˜ë¬¸ì ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ëª…í™•íˆ ì œì‹œí•˜ì„¸ìš”.

**ì™œ ë¬¸ì œì¸ê°€?**
ë©´ì ‘ê´€ì´ ì´ ë¶€ë¶„ì„ ë³´ê³  ë– ì˜¬ë¦´ ìˆ˜ ìˆëŠ” ì˜ë¬¸ì ì´ë‚˜ ìš°ë ¤ì‚¬í•­ì„ ì„¤ëª…í•˜ì„¸ìš”. ì´ ë¬¸ì œê°€ ì™œ ë©´ì ‘ì—ì„œ ì¹˜ëª…ì ì¼ ìˆ˜ ìˆëŠ”ì§€ë„ í•¨ê»˜ ì„¤ëª…í•˜ì„¸ìš”. (ì˜ˆ: "ì´ ë¶€ë¶„ì€ ë©´ì ‘ í•©ê²©ë¥ ì„ 50% ì´ìƒ ë‚®ì¶œ ìˆ˜ ìˆëŠ” ì¹˜ëª…ì  ì´ìŠˆì…ë‹ˆë‹¤")


## âš ï¸ [í”¼ë“œë°± ë° ê°œì„ ì‚¬í•­]

**ë°œê²¬ëœ ì£¼ìš” ì´ìŠˆ (ìµœëŒ€ 3ê°œ):**

### 1ï¸âƒ£ ì²« ë²ˆì§¸ ë¬¸ì œëª…

**ë°œê²¬ëœ ë‚´ìš©:**
ì´ë ¥ì„œì—ì„œ ë°œê²¬ëœ êµ¬ì²´ì  ë‚´ìš©ì„ ìˆ˜ì¹˜, ê¸°ê°„, ì‚¬ì‹¤ ê¸°ë°˜ìœ¼ë¡œ ì œì‹œí•˜ì„¸ìš”.

**ë¦¬ìŠ¤í¬ ìˆ˜ì¤€:** ğŸ”´ ë§¤ìš° ë†’ìŒ / ğŸŸ  ë†’ìŒ / ğŸŸ¡ ë³´í†µ

**ë©´ì ‘ê´€ì´ ë¬¼ì–´ë³¼ ì§ˆë¬¸:**
ì‹¤ì œë¡œ ë©´ì ‘ì¥ì—ì„œ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” êµ¬ì²´ì  ì§ˆë¬¸ì„ ì œì‹œí•˜ì„¸ìš”. (ì˜ˆ: "ì´ ê¸°ê°„ ë™ì•ˆ ì •í™•íˆ ë¬´ì—‡ì„ í–ˆë‚˜ìš”?")

**ì™„ë²½í•œ ëŒ€ì‘ ì „ëµ:**
STAR ê¸°ë²•ì„ ì ìš©í•œ ë‹µë³€ ì „ëµì„ 3-4ì¤„ë¡œ ì‘ì„±í•˜ì„¸ìš”. ë°˜ë“œì‹œ ìˆ˜ì¹˜ì™€ ì„±ê³¼ë¥¼ í¬í•¨í•˜ì„¸ìš”.

**âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ë‹µë³€:**
í”¼í•´ì•¼ í•  í‘œí˜„ì„ ì œì‹œí•˜ì„¸ìš”. (ì˜ˆ: "ì—´ì‹¬íˆ ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤" ê°™ì€ ëª¨í˜¸í•œ í‘œí˜„)

---

### 2ï¸âƒ£ ë‘ ë²ˆì§¸ ë¬¸ì œëª… (ìˆì„ ê²½ìš°ë§Œ)

**ë°œê²¬ëœ ë‚´ìš©:**
ì´ë ¥ì„œì—ì„œ ë°œê²¬ëœ êµ¬ì²´ì  ë‚´ìš©ì„ ìˆ˜ì¹˜, ê¸°ê°„, ì‚¬ì‹¤ ê¸°ë°˜ìœ¼ë¡œ ì œì‹œí•˜ì„¸ìš”.

**ë¦¬ìŠ¤í¬ ìˆ˜ì¤€:** ğŸ”´ ë§¤ìš° ë†’ìŒ / ğŸŸ  ë†’ìŒ / ğŸŸ¡ ë³´í†µ

**ë©´ì ‘ê´€ì´ ë¬¼ì–´ë³¼ ì§ˆë¬¸:**
ì‹¤ì œë¡œ ë©´ì ‘ì¥ì—ì„œ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” êµ¬ì²´ì  ì§ˆë¬¸ì„ ì œì‹œí•˜ì„¸ìš”.

**ì™„ë²½í•œ ëŒ€ì‘ ì „ëµ:**
STAR ê¸°ë²•ì„ ì ìš©í•œ ë‹µë³€ ì „ëµì„ 3-4ì¤„ë¡œ ì‘ì„±í•˜ì„¸ìš”. ë°˜ë“œì‹œ ìˆ˜ì¹˜ì™€ ì„±ê³¼ë¥¼ í¬í•¨í•˜ì„¸ìš”.

**âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ë‹µë³€:**
í”¼í•´ì•¼ í•  í‘œí˜„ì„ ì œì‹œí•˜ì„¸ìš”.

---

### 3ï¸âƒ£ ì„¸ ë²ˆì§¸ ë¬¸ì œëª… (ìˆì„ ê²½ìš°ë§Œ)

**ë°œê²¬ëœ ë‚´ìš©:**
ì´ë ¥ì„œì—ì„œ ë°œê²¬ëœ êµ¬ì²´ì  ë‚´ìš©ì„ ìˆ˜ì¹˜, ê¸°ê°„, ì‚¬ì‹¤ ê¸°ë°˜ìœ¼ë¡œ ì œì‹œí•˜ì„¸ìš”.

**ë¦¬ìŠ¤í¬ ìˆ˜ì¤€:** ğŸ”´ ë§¤ìš° ë†’ìŒ / ğŸŸ  ë†’ìŒ / ğŸŸ¡ ë³´í†µ

**ë©´ì ‘ê´€ì´ ë¬¼ì–´ë³¼ ì§ˆë¬¸:**
ì‹¤ì œë¡œ ë©´ì ‘ì¥ì—ì„œ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” êµ¬ì²´ì  ì§ˆë¬¸ì„ ì œì‹œí•˜ì„¸ìš”.

**ì™„ë²½í•œ ëŒ€ì‘ ì „ëµ:**
STAR ê¸°ë²•ì„ ì ìš©í•œ ë‹µë³€ ì „ëµì„ 3-4ì¤„ë¡œ ì‘ì„±í•˜ì„¸ìš”. ë°˜ë“œì‹œ ìˆ˜ì¹˜ì™€ ì„±ê³¼ë¥¼ í¬í•¨í•˜ì„¸ìš”.

**âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ë‹µë³€:**
í”¼í•´ì•¼ í•  í‘œí˜„ì„ ì œì‹œí•˜ì„¸ìš”.


## ğŸ“‹ [ê°œì„ ëœ ë‚´ìš© ì˜ˆì‹œ - ë©´ì ‘ ì¤€ë¹„ìš©]

ìœ„ì—ì„œ ì œì‹œí•œ ëŒ€ì‘ ì „ëµì„ ë°”íƒ•ìœ¼ë¡œ, ë©´ì ‘ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹µë³€ ì˜ˆì‹œë¥¼ ì œì‹œí•˜ì„¸ìš”. ì‚¬ìš©ìê°€ ì´ë¥¼ ì•”ê¸°í•˜ê³  ì—°ìŠµí•  ìˆ˜ ìˆë„ë¡ ëª…í™•í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”.

**ğŸ’¬ ì—°ìŠµ íŒ:**
ì´ ë‹µë³€ì„ ë§¤ì¼ 3ë²ˆì”© í° ì†Œë¦¬ë¡œ ì—°ìŠµí•˜ë©´ ë©´ì ‘ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


## ğŸ¯ [ì˜ˆìƒ ì§ˆë¬¸ ë° ëŒ€ì‘]

### Q1: ê°€ì¥ í™•ì‹¤í•˜ê²Œ ë‚˜ì˜¬ ì§ˆë¬¸ (ì´ë ¥ì„œì˜ í•µì‹¬ ì´ìŠˆ ê¸°ë°˜)

**ë©´ì ‘ê´€ì´ ì´ ì§ˆë¬¸ì„ í•˜ëŠ” ì´ìœ :**
ì´ ì§ˆë¬¸ì´ ì™œ ë‚˜ì˜¬ ìˆ˜ë°–ì— ì—†ëŠ”ì§€ ì„¤ëª…í•˜ì„¸ìš”. (ì˜ˆ: "ì´ë ¥ì„œì˜ ëª¨í˜¸í•œ í‘œí˜„ ë•Œë¬¸ì— ë°˜ë“œì‹œ í™•ì¸í•˜ê³  ì‹¶ì–´í•©ë‹ˆë‹¤")

**ì™„ë²½í•œ ë‹µë³€ (STAR ê¸°ë²•):**

**S (Situation):** ìƒí™© ì„¤ëª… 1-2ì¤„

**T (Task):** ê³¼ì œë‚˜ ëª©í‘œ 1ì¤„ (ìˆ˜ì¹˜ í¬í•¨)

**A (Action):** êµ¬ì²´ì  í–‰ë™ 3-4ì¤„ (ìˆ˜ì¹˜, ê¸°ê°„, ë°©ë²• ëª…ì‹œ)

**R (Result):** ì¸¡ì • ê°€ëŠ¥í•œ ì„±ê³¼ 2ì¤„ (ìˆ˜ì¹˜ í•„ìˆ˜)

**âœ… ë©´ì ‘ê´€ì´ ì¢‹ì•„í•˜ëŠ” í‘œí˜„:**
ì‹¤ì œë¡œ ë©´ì ‘ì¥ì—ì„œ ë§í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë¬¸ì¥ì„ ì œì‹œí•˜ì„¸ìš”. (ì˜ˆ: "ì €ëŠ” 3ê°œì›”ê°„ ë§¤ì¼ ê³ ê° 20ëª…ì—ê²Œ ì§ì ‘ ë°©ë¬¸í•˜ì—¬ ë§¤ì¶œì„ 30% ì¦ê°€ì‹œì¼°ìŠµë‹ˆë‹¤")

**âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  í‘œí˜„:**
í”¼í•´ì•¼ í•  í‘œí˜„ì„ ì œì‹œí•˜ì„¸ìš”. (ì˜ˆ: "ì—´ì‹¬íˆ í–ˆìŠµë‹ˆë‹¤", "ë§ì´ ë°°ì› ìŠµë‹ˆë‹¤" ë“± ëª¨í˜¸í•œ í‘œí˜„)

---

### Q2: ë‘ ë²ˆì§¸ë¡œ ë‚˜ì˜¬ ê°€ëŠ¥ì„±ì´ ë†’ì€ ì§ˆë¬¸

**ë©´ì ‘ê´€ì´ ì´ ì§ˆë¬¸ì„ í•˜ëŠ” ì´ìœ :**
ì´ ì§ˆë¬¸ì´ ì™œ ë‚˜ì˜¬ ìˆ˜ë°–ì— ì—†ëŠ”ì§€ ì„¤ëª…í•˜ì„¸ìš”.

**ì™„ë²½í•œ ë‹µë³€ (STAR ê¸°ë²•):**

**S (Situation):** ìƒí™© ì„¤ëª… 1-2ì¤„

**T (Task):** ê³¼ì œë‚˜ ëª©í‘œ 1ì¤„ (ìˆ˜ì¹˜ í¬í•¨)

**A (Action):** êµ¬ì²´ì  í–‰ë™ 3-4ì¤„ (ìˆ˜ì¹˜, ê¸°ê°„, ë°©ë²• ëª…ì‹œ)

**R (Result):** ì¸¡ì • ê°€ëŠ¥í•œ ì„±ê³¼ 2ì¤„ (ìˆ˜ì¹˜ í•„ìˆ˜)

**âœ… ë©´ì ‘ê´€ì´ ì¢‹ì•„í•˜ëŠ” í‘œí˜„:**
ì‹¤ì œë¡œ ë©´ì ‘ì¥ì—ì„œ ë§í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë¬¸ì¥ì„ ì œì‹œí•˜ì„¸ìš”.

**âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  í‘œí˜„:**
í”¼í•´ì•¼ í•  í‘œí˜„ì„ ì œì‹œí•˜ì„¸ìš”.

---

### Q3: ì„¸ ë²ˆì§¸ ì§ˆë¬¸ (ìˆì„ ê²½ìš°ë§Œ)

**ë©´ì ‘ê´€ì´ ì´ ì§ˆë¬¸ì„ í•˜ëŠ” ì´ìœ :**
ì´ ì§ˆë¬¸ì´ ì™œ ë‚˜ì˜¬ ìˆ˜ë°–ì— ì—†ëŠ”ì§€ ì„¤ëª…í•˜ì„¸ìš”.

**ì™„ë²½í•œ ë‹µë³€ (STAR ê¸°ë²•):**

**S (Situation):** ìƒí™© ì„¤ëª… 1-2ì¤„

**T (Task):** ê³¼ì œë‚˜ ëª©í‘œ 1ì¤„ (ìˆ˜ì¹˜ í¬í•¨)

**A (Action):** êµ¬ì²´ì  í–‰ë™ 3-4ì¤„ (ìˆ˜ì¹˜, ê¸°ê°„, ë°©ë²• ëª…ì‹œ)

**R (Result):** ì¸¡ì • ê°€ëŠ¥í•œ ì„±ê³¼ 2ì¤„ (ìˆ˜ì¹˜ í•„ìˆ˜)

**âœ… ë©´ì ‘ê´€ì´ ì¢‹ì•„í•˜ëŠ” í‘œí˜„:**
ì‹¤ì œë¡œ ë©´ì ‘ì¥ì—ì„œ ë§í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ë¬¸ì¥ì„ ì œì‹œí•˜ì„¸ìš”.

**âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  í‘œí˜„:**
í”¼í•´ì•¼ í•  í‘œí˜„ì„ ì œì‹œí•˜ì„¸ìš”.
"""

def get_openai_client():
    if not settings.OPENAI_API_KEY:
        raise ValueError('OpenAI API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.')
    return OpenAI(api_key=settings.OPENAI_API_KEY)

def call_openai_api(prompt, max_tokens=2000):
    try:
        client = get_openai_client()
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[{"role": "user", "content": prompt}],
            max_tokens=max_tokens,
            temperature=0.7
        )
        return response.choices[0].message.content.strip()
    except ValueError as e:
        logger.error(f'OpenAI API ValueError: {e}')
        raise
    except Exception as e:
        error_msg = str(e).lower()
        logger.error(f'OpenAI API ì˜¤ë¥˜: {e}')
        if 'rate limit' in error_msg:
            logger.warning('OpenAI API í˜¸ì¶œ í•œë„ ì´ˆê³¼')
            raise ValueError('API í˜¸ì¶œ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.')
        raise ValueError(f'AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}')

class ResumeViewSet(viewsets.ViewSet):
    permission_classes = [AllowAny]
    
    @action(detail=False, methods=['post'], url_path='analyze')
    def analyze(self, request):
        section = request.data.get('section')
        content = request.data.get('content', '').strip()
        
        if not content:
            logger.warning(f'ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨: ë‚´ìš© ì—†ìŒ (section: {section})')
            return Response({'error': 'ë¶„ì„í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'}, status=status.HTTP_400_BAD_REQUEST)
        if section not in SECTION_LABELS:
            logger.warning(f'ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨: ìœ íš¨í•˜ì§€ ì•Šì€ ì„¹ì…˜ (section: {section})')
            return Response({'error': 'ìœ íš¨í•˜ì§€ ì•Šì€ ì„¹ì…˜ì…ë‹ˆë‹¤.'}, status=status.HTTP_400_BAD_REQUEST)
        if len(content) > 500:
            content = content[:500]
        
        section_label = SECTION_LABELS[section]
        prompt = ANALYZE_SECTION_PROMPT_TEMPLATE.format(
            section_label=section_label,
            content=content
        )
        
        try:
            feedback = call_openai_api(prompt, max_tokens=2500)
            return Response({'feedback': feedback}, status=status.HTTP_200_OK)
        except ValueError as e:
            logger.error(f'ì„¹ì…˜ ë¶„ì„ ì‹¤íŒ¨: {section} - {e}')
            return Response({'error': str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)
    
    @action(detail=False, methods=['post'], url_path='analyze-full')
    def analyze_full(self, request):
        resume_data = request.data.get('resumeData')
        if not resume_data:
            logger.warning('ì „ì²´ ë¶„ì„ ìš”ì²­ ì‹¤íŒ¨: ì´ë ¥ì„œ ë°ì´í„° ì—†ìŒ')
            return Response({'error': 'ì´ë ¥ì„œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'}, status=status.HTTP_400_BAD_REQUEST)
        
        try:
            resume_json = json.dumps(resume_data, ensure_ascii=False, indent=2)
        except (TypeError, ValueError) as e:
            logger.error(f'ì´ë ¥ì„œ ë°ì´í„° ë³€í™˜ ì‹¤íŒ¨: {e}')
            return Response({'error': f'ì´ë ¥ì„œ ë°ì´í„° ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}'}, status=status.HTTP_400_BAD_REQUEST)
        
        prompt = ANALYZE_FULL_PROMPT_TEMPLATE.format(resume_json=resume_json)
        
        try:
            feedback = call_openai_api(prompt, max_tokens=3000)
            return Response({'feedback': feedback}, status=status.HTTP_200_OK)
        except ValueError as e:
            error_msg = str(e)
            status_code = status.HTTP_429_TOO_MANY_REQUESTS if 'í•œë„' in error_msg else status.HTTP_500_INTERNAL_SERVER_ERROR
            logger.error(f'ì „ì²´ ë¶„ì„ ì‹¤íŒ¨: {error_msg}')
            return Response({'error': error_msg}, status=status_code)

